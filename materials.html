<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Materials — Logic Legend</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#1e3c72;--bg2:#27ae60;--card:#fff;--accent:#27ae60;--shadow:0 14px 40px rgba(11,22,39,0.12)}
    html,body{height:100%;margin:0}
    body{font-family:'Inter',Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:1000px;background:var(--card);border-radius:16px;padding:22px;box-shadow:var(--shadow)}
    h1{margin:0 0 6px;font-size:20px;color:#10203a}
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    label{font-weight:600;color:#334155;margin-right:6px}
    select,input{padding:8px 10px;border-radius:8px;border:1px solid #e6edf3}
    .btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;color:#334155;border:1px solid #e6edf3}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{padding:10px 12px;border-bottom:1px solid #eef2f6;text-align:left;font-size:14px}
    th{background:transparent;color:#10203a;font-weight:600}
    .muted{color:#6b7280;font-size:13px}
    .form-row{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .form-row input{min-width:160px}
    .summary{margin-top:12px;font-weight:700}
  </style>
</head>
<body>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1>Materials Log</h1>
        <div class="muted">Add material entries and view by month/year.</div>
      </div>
      <div class="controls">
        <button id="home" class="btn">Home</button>
      </div>
    </div>

    <div style="margin-top:14px">
      <div class="form-row">
        <label for="matMonth">Month:</label>
        <select id="matMonth">
          <option value="all">All</option>
        </select>
        <label for="matYear">Year:</label>
        <select id="matYear">
          <option value="all">All</option>
        </select>
        <label for="extraRate">Extra rate/kg &gt;5kg:</label>
        <input id="extraRate" type="number" value="10" step="0.01" style="width:110px" />
        <button id="filter" class="btn ghost">Filter</button>
        <button id="export" class="btn">Export</button>
        <button id="clear" class="btn ghost">Clear</button>
      </div>

      <div style="margin-top:14px;border-top:1px solid #eef2f6;padding-top:14px">
        <div style="font-weight:700;margin-bottom:8px">Add new entry</div>
        <div class="form-row">
          <input id="material" type="text" placeholder="Material (e.g. Plastic)" />
          <input id="weight" type="number" placeholder="Weight (kg)" step="0.01" />
          <input id="amount" type="number" placeholder="Amount collected / penalty" step="0.01" />
          <select id="entryMonth"></select>
          <select id="entryYear"></select>
          <button id="add" class="btn">Add</button>
        </div>
      </div>

      <div class="summary" id="totals"></div>

      <div id="tableWrap"></div>
    </div>
  </div>

  <script>
    const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    const now = new Date();

    function fillMonthYear(selectMonth, selectYear){
      monthNames.forEach((m,i)=> selectMonth.appendChild(new Option(m, i+1)));
      const start = now.getFullYear() - 5; const end = now.getFullYear() + 1;
      for(let y=end;y>=start;y--){ selectYear.appendChild(new Option(y, y)); }
      // set defaults to current
      selectMonth.value = now.getMonth()+1; selectYear.value = now.getFullYear();
    }

    const matMonth = document.getElementById('matMonth');
    const matYear = document.getElementById('matYear');
    const entryMonth = document.getElementById('entryMonth');
    const entryYear = document.getElementById('entryYear');
    const tableWrap = document.getElementById('tableWrap');

    // populate month/year selects
    function populateFilterMonths(){
      monthNames.forEach((m,i)=> matMonth.appendChild(new Option(m, i+1)));
      const start = now.getFullYear() - 5; const end = now.getFullYear() + 1;
      for(let y=end;y>=start;y--){ matYear.appendChild(new Option(y,y)); }
      // default 'All'
      matMonth.value = 'all'; matYear.value = 'all';
    }
    populateFilterMonths(); fillMonthYear(entryMonth, entryYear);

    document.getElementById('home').addEventListener('click', ()=> window.location.href='Untitled-1.html');

    function loadMaterials(){ return JSON.parse(localStorage.getItem('materials')||'[]'); }
    function saveMaterials(arr){ localStorage.setItem('materials', JSON.stringify(arr)); }

    function renderTable(filterM, filterY){
      const items = loadMaterials();
      const filtered = items.filter(it => {
        if(filterM && filterM!=='all' && String(it.month) !== String(filterM)) return false;
        if(filterY && filterY!=='all' && String(it.year) !== String(filterY)) return false;
        return true;
      });

      if(!filtered.length){ tableWrap.innerHTML = '<div class="muted" style="padding:18px;text-align:center">No entries for selected month/year.</div>'; document.getElementById('totals').textContent=''; return }

      let html = '<table><thead><tr><th>Material</th><th>Weight (kg)</th><th>Amount</th><th>Extra</th><th>Total</th><th style="width:120px">Period</th><th>Actions</th></tr></thead><tbody>';
      let totalWeight=0, totalAmount=0, totalExtra=0;
      filtered.forEach((it,i)=>{
        const extra = Number(it.extra || 0);
        const amt = Number(it.amount || 0);
        const total = amt + extra;
        html += `<tr data-id="${i}"><td>${escapeHtml(it.material)}</td><td>${Number(it.weight).toFixed(2)}</td><td>${amt.toFixed(2)}</td><td>${extra.toFixed(2)}</td><td>${total.toFixed(2)}</td><td>${monthNames[it.month-1]} ${it.year}</td><td><button data-idx="${i}" class="btn ghost del">Delete</button></td></tr>`;
        totalWeight += Number(it.weight);
        totalAmount += total;
        totalExtra += extra;
      });
      html += `</tbody></table>`;
      tableWrap.innerHTML = html;
      document.getElementById('totals').textContent = 'Totals — Weight: ' + totalWeight.toFixed(2) + ' kg  |  Amount (incl. extra): ' + totalAmount.toFixed(2) + '  |  Extra: ' + totalExtra.toFixed(2);

      tableWrap.querySelectorAll('button.del').forEach(b=> b.addEventListener('click', e=>{
        const idx = Number(e.currentTarget.dataset.idx);
        const all = loadMaterials();
        // find matching index in full array by same month/year/material/weight/amount (stable enough)
        const toDelete = filtered[idx];
        const fullIdx = all.findIndex(x => x.id === toDelete.id);
        if(fullIdx>-1){ all.splice(fullIdx,1); saveMaterials(all); renderTable(matMonth.value, matYear.value); }
      }));
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]}); }

    document.getElementById('add').addEventListener('click', ()=>{
      const material = document.getElementById('material').value.trim();
      const weight = parseFloat(document.getElementById('weight').value);
      const amount = parseFloat(document.getElementById('amount').value);
      const month = Number(entryMonth.value);
      const year = Number(entryYear.value);
      const rate = parseFloat(document.getElementById('extraRate').value) || 0;
      if(!material || isNaN(weight) || isNaN(amount)){ alert('Please fill material, weight and amount.'); return }
      // compute extra for weight above 5 kg
      const extra = weight > 5 ? (weight - 5) * rate : 0;
      const items = loadMaterials();
      items.push({ id: 'M' + Date.now(), material, weight: Number(weight), amount: Number(amount), extra: Number(extra), month, year });
      saveMaterials(items);
      renderTable(matMonth.value, matYear.value);
      // clear inputs
      document.getElementById('material').value=''; document.getElementById('weight').value=''; document.getElementById('amount').value='';
    });

    document.getElementById('filter').addEventListener('click', ()=> renderTable(matMonth.value, matYear.value));
    document.getElementById('export').addEventListener('click', ()=>{
      const data = loadMaterials(); const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='materials.json'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('clear').addEventListener('click', ()=>{ if(!confirm('Clear all material entries?')) return; localStorage.removeItem('materials'); renderTable(matMonth.value, matYear.value); });

    // initial render
    renderTable('all','all');
  </script>
</body>
</html>
